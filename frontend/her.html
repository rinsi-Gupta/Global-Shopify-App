<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Artisan</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
        rel="stylesheet">
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html,
        body {
            overflow-x: hidden;
        }
    </style>
</head>

<body class="font-['Open_Sans'] bg-gray-50">
    <!-- Navigation Bar -->
    <div id="navbar-container"></div>

    <!-- Main Content -->
    <div class="max-w-[1440px] mx-auto px-4 py-6 pb-6 flex flex-col md:flex-row gap-6">

        <!-- Filters (mobile and desktop) -->
        <aside class="w-full md:w-[250px] shrink-0 md:self-start">
            <div class="bg-white p-5 rounded-lg shadow-md md:sticky md:top-[100px]">
                <h2 class="text-xl font-bold mb-6">Filters</h2>

                <!-- Color Filters -->
                <div class="mb-6">
                    <button id="toggleColors"
                        class="flex items-center justify-between w-full font-semibold mb-4 text-left">
                        <span>Colors</span>
                        <span id="arrow"
                            class="material-symbols-outlined transition-transform duration-300">expand_more</span>
                    </button>

                    <div id="colorOptions" class="grid grid-cols-4 gap-3 hidden">
                        <button class="w-8 h-8 rounded-full bg-red-500 color-filter" data-color="red"></button>
                        <button class="w-8 h-8 rounded-full bg-blue-500 color-filter" data-color="blue"></button>
                        <button class="w-8 h-8 rounded-full bg-green-500 color-filter" data-color="green"></button>
                        <button class="w-8 h-8 rounded-full bg-yellow-500 color-filter" data-color="yellow"></button>
                        <button class="w-8 h-8 rounded-full bg-purple-500 color-filter" data-color="purple"></button>
                        <button class="w-8 h-8 rounded-full bg-pink-500 color-filter" data-color="pink"></button>
                        <button class="w-8 h-8 rounded-full bg-black color-filter" data-color="black"></button>
                        <button class="w-8 h-8 rounded-full bg-white border color-filter" data-color="white"></button>
                        <button class="w-8 h-8 rounded-full bg-orange-500 color-filter" data-color="orange"></button>
                        <button class="w-8 h-8 rounded-full bg-teal-500 color-filter" data-color="teal"></button>
                        <button class="w-8 h-8 rounded-full bg-gray-500 color-filter" data-color="gray"></button>
                        <button class="w-8 h-8 rounded-full bg-yellow-900 color-filter"
                            data-color="dark-brown"></button>
                        <button class="w-8 h-8 rounded-full bg-yellow-700 color-filter" data-color="golden"></button>
                        <button class="w-8 h-8 rounded-full bg-orange-200 color-filter" data-color="skin"></button>
                    </div>
                </div>


                <!-- Price Range -->
                <div class="mb-8">
                    <h3 class="font-semibold mb-4">Price Range</h3>
                    <input type="range" id="price-range" class="w-full h-2 bg-blue-100 rounded-lg cursor-pointer"
                        min="100" max="10000" step="10" />
                    <div class="flex justify-between mt-2 text-sm text-gray-600">
                        <span>Rs 100</span>
                        <span>Rs 10000</span>
                    </div>
                    <p class="mt-2 text-lg font-semibold" id="price-display">Selected Price: Rs 10000</p>
                </div>

                <!-- Sort -->
                <div class="mb-8">
                    <h3 class="font-semibold mb-4">Sort By</h3>
                    <select id="sort-options" class="w-full p-2 border rounded">
                        <option value="default">Default</option>
                        <option value="low-to-high">Price: Low to High</option>
                        <option value="high-to-low">Price: High to Low</option>
                    </select>
                </div>

                <button id="apply-filters"
                    class="w-full bg-blue-600 text-white py-3 rounded-xl font-semibold hover:bg-blue-700 transform hover:scale-105 transition-all duration-300">
                    Apply Filters
                </button>
            </div>
        </aside>

        <!-- Product List -->
        <div class="flex-1 overflow-y-auto max-h-[calc(100vh-120px)] pr-2">
            <div id="selected-filters" class="mb-4 flex flex-wrap gap-2"></div>

            <div id="no-products-alert" class="hidden text-center my-8">
                <img src="images/not.gif" alt="No Products Found" class="w-32 h-32 mb-4 mx-auto">
                <span class="text-lg font-semibold text-red-500">No products found!</span>
            </div>

            <main id="product-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Product cards go here -->
                <div class="bg-white p-4 rounded-lg shadow">
                    <img src="https://via.placeholder.com/150" class="w-full h-48 object-cover rounded mb-2"
                        alt="Product">
                    <h4 class="text-lg font-semibold">Sample Product</h4>
                    <p class="text-gray-600">Rs 999</p>
                </div>
            </main>
        </div>
    </div>
    <!-- Footer -->
    <div id="footer-container"></div>

    <style>
        @keyframes marquee {
            0% {
                transform: translateX(0%);
            }

            100% {
                transform: translateX(-50%);
            }
        }

        .animate-marquee {
            display: flex;
            animation: marquee 30s linear infinite;
        }

        .hover\:paused:hover {
            animation-play-state: paused;
        }

        @media (hover: none) {
            .animate-marquee:active {
                animation-play-state: paused;
            }
        }

        .text-brown-1000 {
            color: #4b1c00;
        }
    </style>

    <style>
        /* Hide scrollbar for WebKit browsers (Chrome, Safari) */
        .custom-scroll::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for Firefox */
        .custom-scroll {
            scrollbar-width: none;
        }

        /* For all browsers */
        .custom-scroll {
            -ms-overflow-style: none;
            /* IE and Edge */
            overflow-x: auto;
        }
    </style>

    <script>
        const toggleBtn = document.getElementById('toggleColors');
        const colorOptions = document.getElementById('colorOptions');
        const arrow = document.getElementById('arrow');

        toggleBtn.addEventListener('click', () => {
            colorOptions.classList.toggle('hidden');
            arrow.classList.toggle('rotate-180');
        });
        const products = [
            {
                name: "Hand stamped bracelet",
                image: "images/her1.webp",
                description: "A woven container featuring an interlaced pattern of materials, creating a sturdy and decorative structure.",
                price: "Rs 2,123",
                color: "gray"
            },
            {
                name: "Personalized Birthday Box",
                image: "images/her2.webp",
                description: "A stylish and durable storage solution featuring an elegant geometric wireframe design with a luxurious gold finish.",
                price: "Rs 2,457",
                color: "pink"
            },
            {
                name: "Custom Watercolor Portrait",
                image: "images/her3.webp",
                description: "A sturdy and versatile storage solution with a timeless open-wire design, offering durability and industrial charm.",
                price: "Rs 1,670",
                color: "blue"
            },
            {
                name: "Garnet Heart Charm Ring",
                image: "images/her4.webp",
                description: "A sturdy and versatile storage solution with a timeless open-wire design, offering durability and industrial charm.",
                price: "Rs 5,670",
                color: "red"
            },
            {
                name: "Custom Chains",
                image: "images/her5.webp",
                description: "A sturdy and versatile storage solution with a timeless open-wire design, offering durability and industrial charm.",
                price: "Rs 9,670",
                color: "gold"
            },
            {
                name: "Custom Earnings",
                image: "images/her6.webp",
                description: "A sturdy and versatile storage solution with a timeless open-wire design, offering durability and industrial charm.",
                price: "Rs 3,670",
                color: "blue"
            },
            {
                name: "Custom Bracelet",
                image: "images/her7.webp",
                description: "A sturdy and versatile storage solution with a timeless open-wire design, offering durability and industrial charm.",
                price: "Rs 4,670",
                color: "black"
            },
        ];

        // Selected Filters Setup
        const selectedFiltersContainer = document.getElementById("selected-filters");
        const selectedFilters = {
            colors: new Set(),
            price: null,
            sort: "default"
        };

        // Function to update selected filters UI
        function updateSelectedFilters() {
            selectedFiltersContainer.innerHTML = "";

            // Display selected colors
            selectedFilters.colors.forEach(color => {
                addFilterTag(color, "color");
            });

            // Display selected price range
            if (selectedFilters.price) {
                addFilterTag(`Up to Rs ${selectedFilters.price}`, "price");
            }

            // Display selected sort option
            if (selectedFilters.sort !== "default") {
                addFilterTag(selectedFilters.sort.replace("-", " "), "sort");
            }
        }

        // Function to add a filter tag
        function addFilterTag(label, type) {
            const filterTag = document.createElement("div");
            filterTag.className = "bg-gray-200 px-3 py-1 rounded-full flex items-center space-x-2";
            filterTag.innerHTML = `
        <span>${label}</span>
        <button class="text-red-500" onclick="removeFilter('${label}', '${type}')">✖</button>
    `;
            selectedFiltersContainer.appendChild(filterTag);
        }

        // Function to remove a selected filter
        function removeFilter(value, type) {
            if (type === "color") {
                selectedFilters.colors.delete(value);
            } else if (type === "price") {
                selectedFilters.price = null;
            } else if (type === "sort") {
                selectedFilters.sort = "default";
            }
            applyFilters();
        }

        // Color Filter Selection
        document.querySelectorAll(".color-filter").forEach(button => {
            button.addEventListener("click", function () {
                const color = this.dataset.color;
                if (selectedFilters.colors.has(color)) {
                    selectedFilters.colors.delete(color);
                    this.classList.remove("selected");
                } else {
                    selectedFilters.colors.add(color);
                    this.classList.add("selected");
                }
                updateSelectedFilters();
            });
        });

        // Price Range Filter
        document.getElementById("price-range").addEventListener("input", function () {
            selectedFilters.price = this.value;
            document.getElementById("price-display").textContent = `Selected Price: Rs ${this.value}`;
            updateSelectedFilters();
        });

        // Sort Filter
        document.getElementById("sort-options").addEventListener("change", function () {
            selectedFilters.sort = this.value;
            updateSelectedFilters();
        });

        // Apply Filters Button
        document.getElementById("apply-filters").addEventListener("click", function () {
            applyFilters();
        });

        // Function to apply filters
        function applyFilters() {
            let filteredProducts = products.filter(product => {
                // Color filter
                if (selectedFilters.colors.size > 0 && !selectedFilters.colors.has(product.color)) {
                    return false;
                }
                // Price filter
                if (selectedFilters.price) {
                    const priceValue = parseInt(product.price.replace("Rs ", "").replace(",", ""));
                    if (priceValue > selectedFilters.price) return false;
                }
                return true;
            });

            // Sorting logic
            if (selectedFilters.sort === "low-to-high") {
                filteredProducts.sort((a, b) => parseInt(a.price.replace("Rs ", "").replace(",", "")) - parseInt(b.price.replace("Rs ", "").replace(",", "")));
            } else if (selectedFilters.sort === "high-to-low") {
                filteredProducts.sort((a, b) => parseInt(b.price.replace("Rs ", "").replace(",", "")) - parseInt(a.price.replace("Rs ", "").replace(",", "")));
            }

            renderProducts(filteredProducts);
            updateSelectedFilters();
        }

        // Function to render filtered products
        function renderProducts(filteredProducts) {
            const productList = document.getElementById("product-list");
            const noProductsAlert = document.getElementById("no-products-alert");
            productList.innerHTML = '';

            if (filteredProducts.length === 0) {
                noProductsAlert.classList.remove("hidden");
            } else {
                noProductsAlert.classList.add("hidden");
                filteredProducts.forEach(product => {
                    const productCard = document.createElement("div");
                    productCard.className = "bg-white rounded-xl shadow-md overflow-hidden transition-all duration-300";
                    productCard.innerHTML = `
                <a href="buynow.html?name=${encodeURIComponent(product.name)}&image=${encodeURIComponent(product.image)}&description=${encodeURIComponent(product.description)}&price=${encodeURIComponent(product.price)}">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-[20rem] object-cover"> <!-- Set a fixed height here -->
                    </a>
                    <div class="p-4">
                        <h3 class="text-xl font-semibold text-gray-800">${product.name}</h3>
                        <p class="text-gray-600 mt-2">${product.description}</p>
                        <div class="flex items-center space-x-4 mt-5">
                            <p class="text-lg font-bold">${product.price}</p>
                            <a href="#" 
   class="relative cursor-pointer group flex left-[9rem] add-to-cart" 
   onclick="addToCart(event, '${product.name}', '${product.image}', '${product.price}')">
    <span class="material-symbols-outlined cart-icon text-2xl transform transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" 
          style="font-variation-settings: 'FILL' 0; color: black;">
        shopping_cart
    </span>
</a>

<a href="#wish" 
   class="relative cursor-pointer group flex left-[9rem]" 
   onclick="addToWishlist(event, '${product.name}', '${product.image}', '${product.description}', '${product.price}')"> 
    <span class="material-symbols-rounded favorite-icon text-2xl transform transition-transform duration-300 group-hover:scale-110 group-hover:-translate-y-1" 
          style="font-variation-settings: 'FILL' 0; color: black;">
        favorite
    </span>  
</a>
                        </div>
                    </div>
                `;
                    productList.appendChild(productCard);
                });
            }
        }

        function filterProducts() {
            const searchInput = document.getElementById('search-input').value.toLowerCase();
            const filteredProducts = products.filter(product => product.name.toLowerCase().includes(searchInput));
            renderProducts(filteredProducts);
        }

        function filterProductsByColor(color) {
            const filteredProducts = products.filter(product => product.color === color);
            renderProducts(filteredProducts);
        }

        function filterProductsByPrice(maxPrice) {
            const filteredProducts = products.filter(product => {
                const priceValue = parseInt(product.price.replace("Rs ", "").replace(",", ""));
                return priceValue <= maxPrice;
            });
            renderProducts(filteredProducts);
        }

        function sortProducts(order) {
            const sortedProducts = [...products]; // Create a copy of the products array
            if (order === 'low-to-high') {
                sortedProducts.sort((a, b) => {
                    const priceA = parseInt(a.price.replace("Rs ", "").replace(",", ""));
                    const priceB = parseInt(b.price.replace("Rs ", "").replace(",", ""));
                    return priceA - priceB; // Sort in ascending order
                });
            } else if (order === 'high-to-low') {
                sortedProducts.sort((a, b) => {
                    const priceA = parseInt(a.price.replace("Rs ", "").replace(",", ""));
                    const priceB = parseInt(b.price.replace("Rs ", "").replace(",", ""));
                    return priceB - priceA; // Sort in descending order
                });
            }
            renderProducts(sortedProducts); // Render the sorted products
        }

        document.addEventListener("DOMContentLoaded", () => {
            updateCartCount();
            updateWishlistCount();
            renderProducts(products); // Show all products by default
        });

        // Color filter event listeners
        const colorFilters = document.querySelectorAll('.color-filter');
        colorFilters.forEach(filter => {
            filter.addEventListener('click', () => {
                const selectedColor = filter.getAttribute('data-color');
                filterProductsByColor(selectedColor);
            });
        });

        // Price range event listener
        const priceRangeInput = document.getElementById('price-range');
        priceRangeInput.addEventListener('input', () => {
            const selectedPrice = priceRangeInput.value;
            document.getElementById('price-display').textContent = `Selected Price: Rs ${selectedPrice}`;
            filterProductsByPrice(selectedPrice);
        });

        // Sort options event listener
        const sortOptions = document.getElementById('sort-options');
        sortOptions.addEventListener('change', () => {
            const selectedSort = sortOptions.value;
            sortProducts(selectedSort);
        });

        // Apply filters button
        const applyFiltersButton = document.getElementById('apply-filters');
        applyFiltersButton.addEventListener('click', () => {
            const selectedPrice = priceRangeInput.value;
            const selectedSort = sortOptions.value;
            filterProductsByPrice(selectedPrice);
            sortProducts(selectedSort);
        });
    </script>


    <script>

        document.addEventListener("DOMContentLoaded", function () {
            // Inject navbar HTML
            const navbarContainer = document.getElementById("navbar-container");
            if (!navbarContainer) {
                console.error("navbar-container element not found in DOM");
                return;
            }
            navbarContainer.innerHTML = nav;

            // DOM elements
            const userNameElement = document.getElementById("userName");
            const loginLink = document.getElementById("loginLink");
            const logoutLink = document.getElementById("logoutLink");
            const dropdownButton = document.getElementById("dropdownButton");
            const dropdownMenu = document.getElementById("dropdownMenu");

            if (!userNameElement || !loginLink || !logoutLink || !dropdownButton || !dropdownMenu) {
                console.error("One or more navbar elements not found:", {
                    userNameElement, loginLink, logoutLink, dropdownButton, dropdownMenu
                });
                return;
            }

            async function updateUI() {
                console.log("Running updateUI...");
                const token = localStorage.getItem("authToken");
                console.log("authToken from localStorage:", token || "null");

                if (token) {
                    try {
                        console.log("Fetching user data from API...");
                        const response = await fetch("http://localhost:5000/api/profile/getprofile", {
                            method: "GET",
                            headers: {
                                "Authorization": `Bearer ${token}`,
                                "Content-Type": "application/json"
                            }
                        });
                        console.log("API response status:", response.status);
                        const user = await response.json();
                        console.log("API response data:", user);

                        if (response.ok && user && user.user && (user.user.Firstname || user.user.firstName)) {
                            const firstName = user.user.Firstname || user.user.firstName;
                            console.log("User logged in, updating UI with:", { firstName });

                            // Update UI
                            userNameElement.textContent = firstName;
                            userNameElement.classList.remove("hidden");
                            userNameElement.style.display = "inline";
                            userNameElement.style.opacity = "1";
                            userNameElement.style.visibility = "visible";
                            loginLink.classList.add("hidden");
                            logoutLink.classList.remove("hidden");
                            logoutLink.style.display = "flex";
                            dropdownMenu.classList.add("hidden");

                            const computedStyle = window.getComputedStyle(userNameElement);
                            console.log("userNameElement computed style:", {
                                display: computedStyle.display,
                                opacity: computedStyle.opacity,
                                visibility: computedStyle.visibility,
                                textContent: userNameElement.textContent
                            });
                        } else {
                            console.log("API error or missing Firstname:", user.message || "Invalid response");
                            resetUI();
                        }
                    } catch (error) {
                        console.error("Error fetching user data:", error.message);
                        resetUI();
                    }
                } else {
                    console.log("No token found, resetting UI");
                    resetUI();
                }
            }

            function resetUI() {
                console.log("Resetting UI");
                userNameElement.textContent = "Guest";
                userNameElement.classList.remove("hidden");
                userNameElement.style.display = "inline";
                userNameElement.style.opacity = "1";
                userNameElement.style.visibility = "visible";
                loginLink.classList.remove("hidden");
                logoutLink.classList.add("hidden");
                logoutLink.style.display = "none";
                dropdownMenu.classList.add("hidden");

                const computedStyle = window.getComputedStyle(userNameElement);
                console.log("userNameElement computed style after reset:", {
                    display: computedStyle.display,
                    opacity: computedStyle.opacity,
                    visibility: computedStyle.visibility,
                    textContent: userNameElement.textContent
                });
            }

            // Make updateUI globally accessible
            window.updateUI = updateUI;

            // Run on load
            updateUI();

            // Logout
            logoutLink.addEventListener("click", function (event) {
                event.preventDefault();
                console.log("Logout link clicked");
                const confirmLogout = confirm("Are you sure you want to log out?");
                if (confirmLogout) {
                    try {
                        console.log("authToken before removal:", localStorage.getItem("authToken"));
                        localStorage.removeItem("authToken");
                        console.log("authToken after removal:", localStorage.getItem("authToken"));
                        resetUI();
                        alert("Logged out successfully!");
                        setTimeout(() => {
                            window.location.href = "userlogin.html";
                        }, 100);
                    } catch (error) {
                        console.error("Error during logout:", error.message);
                        alert("Failed to log out. Please try again.");
                    }
                }
            });

            // Dropdown toggle
            dropdownButton.addEventListener("click", function (event) {
                console.log("Toggling dropdown menu");
                dropdownMenu.classList.toggle("hidden");
                event.stopPropagation();
            });

            document.addEventListener("click", function (event) {
                if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                    console.log("Closing dropdown menu (clicked outside)");
                    dropdownMenu.classList.add("hidden");
                }
            });

            // Sidebar toggle
            const toggleSidebar = document.getElementById("toggleSidebar");
            const closeSidebar = document.getElementById("closeSidebar");
            const sidebar = document.getElementById("sidebar");

            if (toggleSidebar && closeSidebar && sidebar) {
                toggleSidebar.addEventListener("click", function () {
                    console.log("Opening sidebar");
                    sidebar.classList.remove("hidden");
                    sidebar.style.right = "0";
                });

                closeSidebar.addEventListener("click", function () {
                    console.log("Closing sidebar");
                    sidebar.style.right = "-100%";
                    setTimeout(() => {
                        sidebar.classList.add("hidden");
                    }, 300); // Wait for slide-out animation (if any)
                });
            } else {
                console.error("Sidebar elements not found:", { toggleSidebar, closeSidebar, sidebar });
            }

            // (Optional) Search functionality placeholder
            function filterProducts() {
                console.log("Filtering products...");
                const searchInput = document.getElementById("search-input");
                if (!searchInput) return;

                const query = searchInput.value.toLowerCase();
                const filteredProducts = products.filter(product =>
                    product.name.toLowerCase().includes(query)
                );
                renderProducts(filteredProducts);
            }
        });

        document.addEventListener('DOMContentLoaded', () => {
            const links = document.querySelectorAll('[data-category]');
            const ACTIVE_CLASS = ['text-orange-500', 'underline'];
            const SELECTED_KEY = 'selectedCategory';

            // 1. Highlight saved category from localStorage
            const savedCategory = localStorage.getItem(SELECTED_KEY);
            if (savedCategory) {
                const activeLink = document.querySelector(`[data-category="${savedCategory}"]`);
                if (activeLink) {
                    activeLink.classList.add(...ACTIVE_CLASS);
                }
            }

            // 2. On click, save clicked category to localStorage (no styling here)
            links.forEach(link => {
                link.addEventListener('click', () => {
                    const category = link.getAttribute('data-category');
                    localStorage.setItem(SELECTED_KEY, category);
                });
            });
        });



        document.addEventListener('DOMContentLoaded', () => {
            const links = document.querySelectorAll('.category-link');
            const ACTIVE_CLASS = ['text-orange-500', 'underline'];
            const SELECTED_KEY = 'selectedCategory';

            // Highlight saved one
            const savedCategory = localStorage.getItem(SELECTED_KEY);
            if (savedCategory) {
                const savedLink = [...links].find(link => link.textContent.trim().toUpperCase() === savedCategory);
                if (savedLink) {
                    savedLink.classList.add(...ACTIVE_CLASS);
                    savedLink.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
                }
            }

            // On click
            links.forEach(link => {
                link.addEventListener('click', e => {
                    // Remove highlight from all
                    links.forEach(l => l.classList.remove(...ACTIVE_CLASS));

                    // Highlight clicked
                    link.classList.add(...ACTIVE_CLASS);

                    // Scroll into view (centered)
                    link.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });

                    // Save it
                    localStorage.setItem(SELECTED_KEY, link.textContent.trim().toUpperCase());
                });
            });
        });





    </script>

    <!-- Toastify JS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="./function.js"></script>


    <script src="footer.js"></script>
    <script src="navbar3.js"></script>


</body>

</html>